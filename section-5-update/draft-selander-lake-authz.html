<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Lightweight Authorization for EDHOC</title>
<meta content="Göran Selander" name="author">
<meta content="John Preuß Mattsson" name="author">
<meta content="Mališa Vučinić" name="author">
<meta content="Michael Richardson" name="author">
<meta content="Aurelio Schellenbaum" name="author">
<meta content="
       This document describes a procedure for augmenting the lightweight authenticated Diffie-Hellman key exchange protocol EDHOC with third party assisted authorization, targeting constrained IoT deployments (RFC 7228). 
    " name="description">
<meta content="xml2rfc 3.17.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-selander-lake-authz-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.17.2
    Python 3.11.3
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.2
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.2
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.6
-->
<link href="draft-selander-lake-authz.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Lightweight Authorization for EDHOC</td>
<td class="right">June 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Selander, et al.</td>
<td class="center">Expires 9 December 2023</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">LAKE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-selander-lake-authz-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-06-07" class="published">7 June 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2023-12-09">9 December 2023</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">G. Selander</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">J. Preuß Mattsson</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">M. Vučinić</div>
<div class="org">INRIA</div>
</div>
<div class="author">
      <div class="author-name">M. Richardson</div>
<div class="org">Sandelman Software Works</div>
</div>
<div class="author">
      <div class="author-name">A. Schellenbaum</div>
<div class="org">ZHAW</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Lightweight Authorization for EDHOC</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes a procedure for augmenting the lightweight authenticated Diffie-Hellman key exchange protocol EDHOC with third party assisted authorization, targeting constrained IoT deployments (RFC 7228).<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ericssonresearch.github.io/ace-ake-authz/draft-selander-lake-authz.html">https://ericssonresearch.github.io/ace-ake-authz/draft-selander-lake-authz.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-selander-lake-authz/">https://datatracker.ietf.org/doc/draft-selander-lake-authz/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Lightweight Authenticated Key Exchange Working Group mailing list (<span><a href="mailto:lake@ietf.org">mailto:lake@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/lake/">https://mailarchive.ietf.org/arch/browse/lake/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/lake/">https://www.ietf.org/mailman/listinfo/lake/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/EricssonResearch/ace-ake-authz">https://github.com/EricssonResearch/ace-ake-authz</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 9 December 2023.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-problem-description" class="internal xref">Problem Description</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-assumptions" class="internal xref">Assumptions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-device-u" class="internal xref">Device (U)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-domain-authenticator-v" class="internal xref">Domain Authenticator (V)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-authorization-service-w" class="internal xref">Authorization Service (W)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-the-protocol" class="internal xref">The Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-reuse-of-edhoc" class="internal xref">Reuse of EDHOC</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-device-authorization-servic" class="internal xref">Device &lt;-&gt; Authorization Service (U &lt;-&gt; W)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-device-authenticator-u-v" class="internal xref">Device &lt;-&gt; Authenticator (U &lt;-&gt; V)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-authenticator-authorization" class="internal xref">Authenticator &lt;-&gt; Authorization Service (V &lt;-&gt; W)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-rest-interface-at-w" class="internal xref">REST Interface at W</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-scheme-https" class="internal xref">Scheme "https"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-scheme-coaps" class="internal xref">Scheme "coaps"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-scheme-coap" class="internal xref">Scheme "coap"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-uris" class="internal xref">URIs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-edhoc-external-authorizatio" class="internal xref">EDHOC External Authorization Data Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-the-well-known-uri-registry" class="internal xref">The Well-Known URI Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-well-known-name-under-arpa-" class="internal xref">Well-Known Name Under ".arpa" Name Space</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-media-types-registry" class="internal xref">Media Types Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-coap-content-formats-regist" class="internal xref">CoAP Content-Formats Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-use-with-constrained-join-p" class="internal xref">Use with Constrained Join Protocol (CoJP)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-network-discovery" class="internal xref">Network Discovery</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-the-enrollment-protocol-wit" class="internal xref">The Enrollment Protocol with Parameter Provisioning</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">For constrained IoT deployments <span>[<a href="#RFC7228" class="cite xref">RFC7228</a>]</span> the overhead and processing contributed by security protocols may be significant which motivates the specification of lightweight protocols that are optimizing, in particular, message overhead (see <span>[<a href="#I-D.ietf-lake-reqs" class="cite xref">I-D.ietf-lake-reqs</a>]</span>).
This document describes a procedure for augmenting the lightweight authenticated Diffie-Hellman key exchange EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span> with third party-assisted authorization.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The procedure involves a device, a domain authenticator, and an authorization service.
The device and domain authenticator perform mutual authentication and authorization, assisted by the authorization service which provides relevant authorization information to the device (a "voucher") and to the authenticator.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">In this document we consider the target interaction for which authorization is needed to be "enrollment", for example joining a network for the first time (e.g., <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>), but it can be applied to authorize other target interactions.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The authorization service may represent the manufacturer of the device, or some other party with information about the device from which a trust anchor has been pre-provisioned into the device.
The (domain) authenticator may represent the service provider or some other party controlling access to the network in which the device is enrolling.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">The protocol assumes that authentication between device and authenticator is performed with EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>, and defines the integration of a lightweight authorization procedure using the External Authorization Data (EAD) fields defined in EDHOC.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">The protocol enables a low message count by performing authorization and enrollment in parallel with authentication, instead of in sequence which is common for network access.
It further reuses protocol elements from EDHOC leading to reduced message sizes on constrained links.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This protocol is applicable to a wide variety of settings, and can be mapped to different authorization architectures.<a href="#section-1-7" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to have an understanding of CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> and EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>.
Appendix C.1 of <span>[<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span> contains some basic info about CBOR.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="prob-desc">
<section id="section-2">
      <h2 id="name-problem-description">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-problem-description" class="section-name selfRef">Problem Description</a>
      </h2>
<p id="section-2-1">The (potentially constrained) device (U) wants to enroll into a domain over a constrained link.
The device authenticates and enforces authorization of the (non-constrained) domain authenticator (V) with the help of a voucher conveying authorization information.
The domain authenticator, in turn, authenticates the device and authorizes its enrollment into the domain.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The procedure is assisted by a (non-constrained) domain authorization service (W) located in a non-constrained network behind the domain authenticator, e.g. on the Internet, providing information to the device (the voucher) and to the domain authenticator as part of the protocol.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">The objective of this document is to specify such a protocol which is lightweight over the constrained link by reusing elements of EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span> and by shifting message overhead to the non-constrained side of the network.
See illustration in <a href="#fig-overview" class="auto internal xref">Figure 1</a>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Note the cardinality of the involved parties, it is expected that the authenticator need to handle a large unspecified number of devices, but for a given device type or manufacturer it is expected that one or a few nodes host authorization services.<a href="#section-2-4" class="pilcrow">¶</a></p>
<span id="name-overview-of-message-flow-ed"></span><div id="fig-overview">
<figure id="figure-1">
        <div id="section-2-5.1">
          <div class="alignCenter art-svg artwork" id="section-2-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="192" width="560" viewBox="0 0 560 192" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px">
              <path d="M 8,64 L 8,160" fill="none" stroke="black"></path>
              <path d="M 96,64 L 96,160" fill="none" stroke="black"></path>
              <path d="M 136,104 L 136,160" fill="none" stroke="black"></path>
              <path d="M 152,64 L 152,104" fill="none" stroke="black"></path>
              <path d="M 200,64 L 200,160" fill="none" stroke="black"></path>
              <path d="M 328,64 L 328,160" fill="none" stroke="black"></path>
              <path d="M 424,64 L 424,160" fill="none" stroke="black"></path>
              <path d="M 552,64 L 552,160" fill="none" stroke="black"></path>
              <path d="M 8,64 L 96,64" fill="none" stroke="black"></path>
              <path d="M 200,64 L 328,64" fill="none" stroke="black"></path>
              <path d="M 424,64 L 552,64" fill="none" stroke="black"></path>
              <path d="M 96,96 L 144,96" fill="none" stroke="black"></path>
              <path d="M 160,96 L 192,96" fill="none" stroke="black"></path>
              <path d="M 328,96 L 416,96" fill="none" stroke="black"></path>
              <path d="M 104,112 L 128,112" fill="none" stroke="black"></path>
              <path d="M 144,112 L 200,112" fill="none" stroke="black"></path>
              <path d="M 336,112 L 424,112" fill="none" stroke="black"></path>
              <path d="M 96,128 L 192,128" fill="none" stroke="black"></path>
              <path d="M 8,160 L 96,160" fill="none" stroke="black"></path>
              <path d="M 200,160 L 328,160" fill="none" stroke="black"></path>
              <path d="M 424,160 L 552,160" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="424,96 412,90.4 412,101.6" fill="black" transform="rotate(0,416,96)"></polygon>
              <polygon class="arrowhead" points="344,112 332,106.4 332,117.6" fill="black" transform="rotate(180,336,112)"></polygon>
              <polygon class="arrowhead" points="200,128 188,122.4 188,133.6" fill="black" transform="rotate(0,192,128)"></polygon>
              <polygon class="arrowhead" points="200,96 188,90.4 188,101.6" fill="black" transform="rotate(0,192,96)"></polygon>
              <polygon class="arrowhead" points="112,112 100,106.4 100,117.6" fill="black" transform="rotate(180,104,112)"></polygon>
              <circle cx="136" cy="112" r="6" class="opendot" fill="white" stroke="black"></circle>
              <circle cx="152" cy="96" r="6" class="opendot" fill="white" stroke="black"></circle>
              <g class="text">
                <text x="160" y="36">Voucher</text>
                <text x="148" y="52">Info</text>
                <text x="376" y="68">Voucher</text>
                <text x="376" y="84">Request</text>
                <text x="52" y="100">Device</text>
                <text x="260" y="100">Domain</text>
                <text x="488" y="100">Authorization</text>
                <text x="264" y="116">Authenticator</text>
                <text x="488" y="116">Service</text>
                <text x="56" y="132">(U)</text>
                <text x="264" y="132">(V)</text>
                <text x="376" y="132">Voucher</text>
                <text x="496" y="132">(W)</text>
                <text x="380" y="148">Response</text>
                <text x="144" y="180">Voucher</text>
              </g>
            </svg><a href="#section-2-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-overview-of-message-flow-ed" class="selfRef">Overview of message flow. EDHOC is used on the constrained link between U and V. Voucher_Info and Voucher are sent in EDHOC External Authorization Data (EAD). The link between V and W is not constrained.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="assumptions">
<section id="section-3">
      <h2 id="name-assumptions">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-assumptions" class="section-name selfRef">Assumptions</a>
      </h2>
<p id="section-3-1">The protocol is based on the following pre-existing relations between the device (U), the domain authenticator (V) and the authorization service (W).<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">U and W have an explicit relation: U is configured with a public key of W, see <a href="#device" class="auto internal xref">Section 3.1</a>.<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.2">V and W have an implicit relation, e.g., based on web PKI with trusted CA certificates, see <a href="#domain-auth" class="auto internal xref">Section 3.2</a>.<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.3">U and V need not have any previous relation, this protocol establishes a relation between U and V.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-3">Each of the three parties have protected communication with the other two during the protocol.<a href="#section-3-3" class="pilcrow">¶</a></p>
<span id="name-overview-of-pre-existing-re"></span><div id="fig-trust">
<figure id="figure-2">
        <div id="section-3-4.1">
          <div class="alignCenter art-svg artwork" id="section-3-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="272" width="568" viewBox="0 0 568 272" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px">
              <path d="M 8,96 L 8,192" fill="none" stroke="black"></path>
              <path d="M 48,64 L 48,96" fill="none" stroke="black"></path>
              <path d="M 48,192 L 48,224" fill="none" stroke="black"></path>
              <path d="M 96,96 L 96,192" fill="none" stroke="black"></path>
              <path d="M 200,96 L 200,192" fill="none" stroke="black"></path>
              <path d="M 264,192 L 264,224" fill="none" stroke="black"></path>
              <path d="M 328,96 L 328,192" fill="none" stroke="black"></path>
              <path d="M 432,96 L 432,192" fill="none" stroke="black"></path>
              <path d="M 496,64 L 496,96" fill="none" stroke="black"></path>
              <path d="M 496,192 L 496,224" fill="none" stroke="black"></path>
              <path d="M 560,96 L 560,192" fill="none" stroke="black"></path>
              <path d="M 64,64 L 480,64" fill="none" stroke="black"></path>
              <path d="M 8,96 L 96,96" fill="none" stroke="black"></path>
              <path d="M 200,96 L 328,96" fill="none" stroke="black"></path>
              <path d="M 432,96 L 560,96" fill="none" stroke="black"></path>
              <path d="M 8,192 L 96,192" fill="none" stroke="black"></path>
              <path d="M 200,192 L 328,192" fill="none" stroke="black"></path>
              <path d="M 432,192 L 560,192" fill="none" stroke="black"></path>
              <path d="M 64,224 L 248,224" fill="none" stroke="black"></path>
              <path d="M 280,224 L 480,224" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="488,224 476,218.4 476,229.6" fill="black" transform="rotate(0,480,224)"></polygon>
              <polygon class="arrowhead" points="488,64 476,58.4 476,69.6" fill="black" transform="rotate(0,480,64)"></polygon>
              <polygon class="arrowhead" points="288,224 276,218.4 276,229.6" fill="black" transform="rotate(180,280,224)"></polygon>
              <polygon class="arrowhead" points="256,224 244,218.4 244,229.6" fill="black" transform="rotate(0,248,224)"></polygon>
              <polygon class="arrowhead" points="72,224 60,218.4 60,229.6" fill="black" transform="rotate(180,64,224)"></polygon>
              <polygon class="arrowhead" points="72,64 60,58.4 60,69.6" fill="black" transform="rotate(180,64,64)"></polygon>
              <g class="text">
                <text x="108" y="52">Explicit</text>
                <text x="180" y="52">relation</text>
                <text x="244" y="52">(e.g.,</text>
                <text x="292" y="52">from</text>
                <text x="340" y="52">device</text>
                <text x="420" y="52">manufacture)</text>
                <text x="380" y="116">non-</text>
                <text x="52" y="132">Device</text>
                <text x="148" y="132">con-</text>
                <text x="260" y="132">Domain</text>
                <text x="380" y="132">con-</text>
                <text x="496" y="132">Authorization</text>
                <text x="152" y="148">stra-</text>
                <text x="264" y="148">Authenticator</text>
                <text x="384" y="148">stra-</text>
                <text x="496" y="148">Service</text>
                <text x="56" y="164">(U)</text>
                <text x="148" y="164">ined</text>
                <text x="264" y="164">(V)</text>
                <text x="380" y="164">ined</text>
                <text x="496" y="164">(W)</text>
                <text x="92" y="244">No</text>
                <text x="140" y="244">previous</text>
                <text x="212" y="244">relation</text>
                <text x="340" y="244">Implicit</text>
                <text x="412" y="244">relation</text>
                <text x="316" y="260">(e.g.,</text>
                <text x="360" y="260">web</text>
                <text x="392" y="260">PKI</text>
                <text x="436" y="260">based)</text>
              </g>
            </svg><a href="#section-3-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-overview-of-pre-existing-re" class="selfRef">Overview of pre-existing relations.</a>
        </figcaption></figure>
</div>
<div id="device">
<section id="section-3.1">
        <h3 id="name-device-u">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-device-u" class="section-name selfRef">Device (U)</a>
        </h3>
<p id="section-3.1-1">To authenticate to V, the device (U) runs EDHOC in the role of Initiator with authentication credential CRED_U, for example, an X.509 certificate or a CBOR Web Token (CWT, <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>). CRED_U may, for example, be carried in ID_CRED_I of EDHOC message_3 or be provisioned to V over a non-constrained network, see bottom of <a href="#fig-protocol" class="auto internal xref">Figure 3</a>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">U also needs to identify itself to W, this device identifier is denoted by ID_U. The purpose of ID_U is for W to be able to determine if the device with this identifier is authorized to enroll with V. ID_U may be a reference to CRED_U, like ID_CRED_I in EDHOC (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>), or a device identifier from a different name space, such as EUI-64 identifiers.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">U is also provisioned with information about W:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">A static public DH key of W (G_W) used to establish secure communication with the authorization service (see <a href="#U-W" class="auto internal xref">Section 4.3</a>).<a href="#section-3.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.2">Location information about the authorization service (LOC_W) that can be used by V to reach W. This is typically a URI but may alternatively be only the domain name.<a href="#section-3.1-4.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="domain-auth">
<section id="section-3.2">
        <h3 id="name-domain-authenticator-v">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-domain-authenticator-v" class="section-name selfRef">Domain Authenticator (V)</a>
        </h3>
<p id="section-3.2-1">To authenticate to U, the domain authenticator (V) runs EDHOC in the role of Responder with an authentication credential CRED_V, which is a CWT Claims Set <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span> containing a public key of V, see <a href="#V_2" class="auto internal xref">Section 4.4.2.1</a>. This proves to U the possession of the private key corresponding to the public key of CRED_V. CRED_V typically needs to be transported to U in EDHOC (using  ID_CRED_R = CRED_V, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>) since there is no previous relation between U and V.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">V and W need to establish a secure (confidentiality and integrity protected) connection for the Voucher Request/Response protocol. Furthermore, W needs access the same credential CRED_V as V used with U, and V needs to prove to W the possession of the private key corresponding to the public key of CRED_V. It is RECOMMENDED that V authenticates to W using the same credential CRED_V as with U.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-3.1">V and W may protect the Voucher Request/Response protocol using TLS 1.3 with client authentication <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> if CRED_V is an X.509 certificate of a signature public key. However, note that CRED_V may not be a valid credential to use with TLS 1.3, e.g., when U and V run EDHOC with method 1 or 3, where the public key of CRED_V is a static Diffie-Hellman key.<a href="#section-3.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-3.2">V may run EDHOC with W using ID_CRED_I = CRED_V. In this case the secure connection between V and W may be based on OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-3.2-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-4">Note that both TLS 1.3 and EDHOC may be run between V and W during this setup procedure. For example, W may authenticate to V using TLS 1.3 with server certificates signed by a CA trusted by V, and then V may run EDHOC using CRED_V over the secure TLS connection to W, see <a href="#fig-protocol" class="auto internal xref">Figure 3</a>.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">Other details of proof-of-possession related to CRED_V and transport of CRED_V are out of scope of this document.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authz-server">
<section id="section-3.3">
        <h3 id="name-authorization-service-w">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-authorization-service-w" class="section-name selfRef">Authorization Service (W)</a>
        </h3>
<p id="section-3.3-1">The authorization service (W) is assumed to have the private DH key corresponding to G_W, which is used to establish secure communication with the device (see <a href="#U-W" class="auto internal xref">Section 4.3</a>). W provides to U the authorization decision for enrollment with V in the form of a voucher (see <a href="#voucher" class="auto internal xref">Section 4.3.2</a>). Authorization policies are out of scope for this document.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Authentication credentials and communication security with V is described in <a href="#domain-auth" class="auto internal xref">Section 3.2</a>. To calculate the voucher, W needs access to message_1 and CRED_V as used in the EDHOC run between U and V, see <a href="#voucher" class="auto internal xref">Section 4.3.2</a>.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-3.1">W MUST verify that CRED_V is bound to the secure connection between W and V<a href="#section-3.3-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-3.2">W MUST verify that V is in possession of the private key corresponding to the public key of CRED_V<a href="#section-3.3-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.3-4">W needs to be available during the execution of the protocol between U and V.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="the-protocol">
<section id="section-4">
      <h2 id="name-the-protocol">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-the-protocol" class="section-name selfRef">The Protocol</a>
      </h2>
<div id="overview">
<section id="section-4.1">
        <h3 id="name-overview">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-4.1-1">The protocol consist of three security sessions going on in parallel:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1-2">
<li id="section-4.1-2.1">The EDHOC protocol between device (U) and (domain) authenticator (V)<a href="#section-4.1-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-2.2">Voucher Request/Response between authenticator (V) and authorization service (W)<a href="#section-4.1-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-2.3">An exchange of voucher-related information, including the voucher itself, between device (U) and authorization service (W), mediated by the authenticator (V).<a href="#section-4.1-2.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.1-3"><a href="#fig-protocol" class="auto internal xref">Figure 3</a> provides an overview of the message flow detailed in this section. An outline of EDHOC is given in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3" class="relref">Section 3</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<span id="name-overview-of-the-protocol-in"></span><div id="fig-protocol">
<figure id="figure-3">
          <div id="section-4.1-4.1">
            <div class="alignCenter art-svg artwork" id="section-4.1-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="752" width="696" viewBox="0 0 696 752" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px">
                <path d="M 8,224 L 8,576" fill="none" stroke="black"></path>
                <path d="M 80,48 L 80,216" fill="none" stroke="black"></path>
                <path d="M 80,232 L 80,568" fill="none" stroke="black"></path>
                <path d="M 80,584 L 80,720" fill="none" stroke="black"></path>
                <path d="M 336,48 L 336,216" fill="none" stroke="black"></path>
                <path d="M 336,232 L 336,568" fill="none" stroke="black"></path>
                <path d="M 336,584 L 336,720" fill="none" stroke="black"></path>
                <path d="M 616,48 L 616,216" fill="none" stroke="black"></path>
                <path d="M 616,232 L 616,568" fill="none" stroke="black"></path>
                <path d="M 616,640 L 616,720" fill="none" stroke="black"></path>
                <path d="M 688,224 L 688,576" fill="none" stroke="black"></path>
                <path d="M 344,96 L 360,96" fill="none" stroke="black"></path>
                <path d="M 384,96 L 400,96" fill="none" stroke="black"></path>
                <path d="M 424,96 L 440,96" fill="none" stroke="black"></path>
                <path d="M 464,96 L 480,96" fill="none" stroke="black"></path>
                <path d="M 512,96 L 528,96" fill="none" stroke="black"></path>
                <path d="M 552,96 L 568,96" fill="none" stroke="black"></path>
                <path d="M 592,96 L 608,96" fill="none" stroke="black"></path>
                <path d="M 344,160 L 360,160" fill="none" stroke="black"></path>
                <path d="M 384,160 L 400,160" fill="none" stroke="black"></path>
                <path d="M 424,160 L 440,160" fill="none" stroke="black"></path>
                <path d="M 464,160 L 480,160" fill="none" stroke="black"></path>
                <path d="M 512,160 L 528,160" fill="none" stroke="black"></path>
                <path d="M 552,160 L 568,160" fill="none" stroke="black"></path>
                <path d="M 592,160 L 608,160" fill="none" stroke="black"></path>
                <path d="M 8,224 L 688,224" fill="none" stroke="black"></path>
                <path d="M 80,272 L 328,272" fill="none" stroke="black"></path>
                <path d="M 336,336 L 608,336" fill="none" stroke="black"></path>
                <path d="M 344,400 L 616,400" fill="none" stroke="black"></path>
                <path d="M 88,464 L 336,464" fill="none" stroke="black"></path>
                <path d="M 80,544 L 328,544" fill="none" stroke="black"></path>
                <path d="M 8,576 L 688,576" fill="none" stroke="black"></path>
                <path d="M 336,672 L 360,672" fill="none" stroke="black"></path>
                <path d="M 384,672 L 400,672" fill="none" stroke="black"></path>
                <path d="M 424,672 L 440,672" fill="none" stroke="black"></path>
                <path d="M 464,672 L 480,672" fill="none" stroke="black"></path>
                <path d="M 512,672 L 528,672" fill="none" stroke="black"></path>
                <path d="M 552,672 L 568,672" fill="none" stroke="black"></path>
                <path d="M 592,672 L 608,672" fill="none" stroke="black"></path>
                <path d="M 344,688 L 360,688" fill="none" stroke="black"></path>
                <path d="M 384,688 L 400,688" fill="none" stroke="black"></path>
                <path d="M 424,688 L 440,688" fill="none" stroke="black"></path>
                <path d="M 464,688 L 480,688" fill="none" stroke="black"></path>
                <path d="M 512,688 L 528,688" fill="none" stroke="black"></path>
                <path d="M 552,688 L 568,688" fill="none" stroke="black"></path>
                <path d="M 592,688 L 616,688" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="616,672 604,666.4 604,677.6" fill="black" transform="rotate(0,608,672)"></polygon>
                <polygon class="arrowhead" points="616,336 604,330.4 604,341.6" fill="black" transform="rotate(0,608,336)"></polygon>
                <polygon class="arrowhead" points="616,160 604,154.4 604,165.6" fill="black" transform="rotate(0,608,160)"></polygon>
                <polygon class="arrowhead" points="616,96 604,90.4 604,101.6" fill="black" transform="rotate(0,608,96)"></polygon>
                <polygon class="arrowhead" points="352,688 340,682.4 340,693.6" fill="black" transform="rotate(180,344,688)"></polygon>
                <polygon class="arrowhead" points="352,400 340,394.4 340,405.6" fill="black" transform="rotate(180,344,400)"></polygon>
                <polygon class="arrowhead" points="352,160 340,154.4 340,165.6" fill="black" transform="rotate(180,344,160)"></polygon>
                <polygon class="arrowhead" points="352,96 340,90.4 340,101.6" fill="black" transform="rotate(180,344,96)"></polygon>
                <polygon class="arrowhead" points="336,544 324,538.4 324,549.6" fill="black" transform="rotate(0,328,544)"></polygon>
                <polygon class="arrowhead" points="336,272 324,266.4 324,277.6" fill="black" transform="rotate(0,328,272)"></polygon>
                <polygon class="arrowhead" points="96,464 84,458.4 84,469.6" fill="black" transform="rotate(180,88,464)"></polygon>
                <g class="text">
                  <text x="80" y="36">U</text>
                  <text x="336" y="36">V</text>
                  <text x="616" y="36">W</text>
                  <text x="416" y="84">Establish</text>
                  <text x="484" y="84">secure</text>
                  <text x="544" y="84">channel</text>
                  <text x="388" y="116">(e.g.,</text>
                  <text x="432" y="116">TLS</text>
                  <text x="468" y="116">with</text>
                  <text x="516" y="116">server</text>
                  <text x="572" y="116">cert.)</text>
                  <text x="416" y="148">Proof</text>
                  <text x="452" y="148">of</text>
                  <text x="508" y="148">possession</text>
                  <text x="436" y="180">(e.g.,</text>
                  <text x="492" y="180">EDHOC)</text>
                  <text x="168" y="260">EDHOC</text>
                  <text x="232" y="260">message_1</text>
                  <text x="140" y="292">(EAD_1</text>
                  <text x="176" y="292">=</text>
                  <text x="212" y="292">LOC_W,</text>
                  <text x="272" y="292">ENC_ID)</text>
                  <text x="408" y="324">Voucher</text>
                  <text x="472" y="324">Request</text>
                  <text x="532" y="324">(VREQ)</text>
                  <text x="404" y="356">(wrapped</text>
                  <text x="464" y="356">EDHOC</text>
                  <text x="532" y="356">message_1)</text>
                  <text x="408" y="388">Voucher</text>
                  <text x="476" y="388">Response</text>
                  <text x="540" y="388">(VRES)</text>
                  <text x="472" y="420">(Voucher)</text>
                  <text x="168" y="452">EDHOC</text>
                  <text x="232" y="452">message_2</text>
                  <text x="164" y="484">(EAD_2</text>
                  <text x="200" y="484">=</text>
                  <text x="244" y="484">Voucher)</text>
                  <text x="168" y="532">EDHOC</text>
                  <text x="232" y="532">message_3</text>
                  <text x="620" y="612">Credential</text>
                  <text x="620" y="628">Database</text>
                  <text x="416" y="660">ID_CRED_I</text>
                  <text x="476" y="660">from</text>
                  <text x="536" y="660">message_3</text>
                  <text x="476" y="708">CRED_U</text>
                </g>
              </svg><a href="#section-4.1-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-overview-of-the-protocol-in" class="selfRef">Overview of the protocol (inside the box): W-assisted authorization of U and V to each other: EDHOC between U and V, and Voucher Request/Response between V and W. Before the protocol, V and W are assumed to have established a secure channel and performed proof-of-possession of relevant keys. Credential lookup of CRED_U may involve W or other credential database.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="reuse">
<section id="section-4.2">
        <h3 id="name-reuse-of-edhoc">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-reuse-of-edhoc" class="section-name selfRef">Reuse of EDHOC</a>
        </h3>
<p id="section-4.2-1">The protocol illustrated in <a href="#fig-protocol" class="auto internal xref">Figure 3</a> reuses several components of EDHOC:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">G_X, the ephemeral public Diffie-Hellman key of U, is also used in the protocol between U and W.<a href="#section-4.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-2.2">
            <p id="section-4.2-2.2.1">SUITES_I includes the cipher suite for EDHOC selected by U, and also defines the algorithms used between U and W (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.6" class="relref">Section 3.6</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>):<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.2.2.1">EDHOC AEAD algorithm: used to encrypt ID_U<a href="#section-4.2-2.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.2-2.2.2.2">EDHOC hash algorithm: used for key derivation and to calculate the voucher<a href="#section-4.2-2.2.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.2-2.2.2.3">EDHOC MAC length in bytes: length of the voucher<a href="#section-4.2-2.2.2.3" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.2-2.2.2.4">EDHOC key exchange algorithm: used to calculate the shared secret between U and W<a href="#section-4.2-2.2.2.4" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.2-2.3">EAD_1, EAD_2 are the External Authorization Data message fields of message_1 and message_2, respectively, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.8" class="relref">Section 3.8</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>. This document specifies the EAD items with ead_label = TBD1, see <a href="#iana-ead" class="auto internal xref">Section 7.1</a>).<a href="#section-4.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-2.4">ID_CRED_I and ID_CRED_R are used to identify the authentication credentials CRED_U and CRED_V, respectively. As shown at the bottom of <a href="#fig-protocol" class="auto internal xref">Figure 3</a>, V may use W to obtain CRED_U. CRED_V is transported in ID_CRED_R in message_2, see <a href="#V_2" class="auto internal xref">Section 4.4.2.1</a>.<a href="#section-4.2-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-3">The protocol also reuses the EDHOC-Extract and EDHOC-Expand key derivation from EDHOC (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-4" class="relref">Section 4</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>).<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1">
            <p id="section-4.2-4.1.1">The intermediate pseudo-random key PRK is derived using EDHOC-Extract():<a href="#section-4.2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1.2.1">
                <p id="section-4.2-4.1.2.1.1">PRK = EDHOC-Extract(salt, IKM)<a href="#section-4.2-4.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1.2.1.2.1">where salt = 0x (the zero-length byte string)<a href="#section-4.2-4.1.2.1.2.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-4.2-4.1.2.1.2.2">IKM is computed as an ECDH cofactor Diffie-Hellman shared secret from the public key of W, G_W, and the private key corresponding to G_X (or v.v.), see Section 5.7.1.2 of <span>[<a href="#NIST-800-56A" class="cite xref">NIST-800-56A</a>]</span>.<a href="#section-4.2-4.1.2.1.2.2" class="pilcrow">¶</a>
</li>
                </ul>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.2-5">The output keying material OKM is derived from PRK using EDHOC-Expand(), which is defined in terms of the EDHOC hash algorithm of the selected cipher suite, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-4.2" class="relref">Section 4.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>:<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-6.1">
            <p id="section-4.2-6.1.1">OKM = EDHOC-Expand(PRK, info, length)<a href="#section-4.2-6.1.1" class="pilcrow">¶</a></p>
<p id="section-4.2-6.1.2">
where<a href="#section-4.2-6.1.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-4.2-7">
<pre>
info = (
   info_label : int,
   context : bstr,
   length : uint,
)
</pre><a href="#section-4.2-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="U-W">
<section id="section-4.3">
        <h3 id="name-device-authorization-servic">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-device-authorization-servic" class="section-name selfRef">Device &lt;-&gt; Authorization Service (U &lt;-&gt; W)</a>
        </h3>
<p id="section-4.3-1">The protocol between U and W is carried between U and V in message_1 and message_2 (<a href="#U-V" class="auto internal xref">Section 4.4</a>), and between V and W in the Voucher Request/Response (<a href="#V-W" class="auto internal xref">Section 4.5</a>). The data is protected between the endpoints using secret keys derived from a Diffie-Hellman shared secret (see <a href="#reuse" class="auto internal xref">Section 4.2</a>) as further detailed in this section.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div id="voucher_info">
<section id="section-4.3.1">
          <h4 id="name-voucher-info">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-voucher-info" class="section-name selfRef">Voucher Info</a>
          </h4>
<p id="section-4.3.1-1">The external authorization data EAD_1 contains an EAD item with ead_label = TBD1 and ead_value = Voucher_Info, which is a CBOR byte string:<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1-2">
<pre>
Voucher_Info = bstr .cbor Voucher_Info_Seq
</pre><a href="#section-4.3.1-2" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-4.3.1-3">
<pre>
Voucher_Info_Seq = (
    LOC_W:      tstr,
    ENC_ID:     bstr
)
</pre><a href="#section-4.3.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-4">where<a href="#section-4.3.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-5.1">LOC_W is a text string used by V to locate W, e.g., a URI or a domain name.<a href="#section-4.3.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-5.2">ENC_ID is a byte string containing an encrypted identifier of U, calculated as follows:<a href="#section-4.3.1-5.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.3.1-6">ENC_ID is 'ciphertext' of COSE_Encrypt0 (<span><a href="https://rfc-editor.org/rfc/rfc9052#section-5.2" class="relref">Section 5.2</a> of [<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>) computed from the following:<a href="#section-4.3.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-7.1">The encryption key K_1 and nonce IV_1 are derived as specified below.<a href="#section-4.3.1-7.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-7.2">'protected' is a byte string of size 0<a href="#section-4.3.1-7.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-7.3">'plaintext and 'external_aad' as below:<a href="#section-4.3.1-7.3" class="pilcrow">¶</a>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-4.3.1-8">
<pre>
plaintext = (
    ID_U:            bstr,
 )
</pre><a href="#section-4.3.1-8" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-4.3.1-9">
<pre>
external_aad = (
    SS:              int,
 )
</pre><a href="#section-4.3.1-9" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-10">where<a href="#section-4.3.1-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-11.1">ID_U is an identifier of the device, see <a href="#device" class="auto internal xref">Section 3.1</a>.<a href="#section-4.3.1-11.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-11.2">SS is the selected cipher suite in SUITES_I of EDHOC message_1, see <a href="#U-V" class="auto internal xref">Section 4.4</a>.<a href="#section-4.3.1-11.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.3.1-12">The derivation of K_1 = EDHOC-Expand(PRK, info, length) uses the following input to the info struct (see <a href="#reuse" class="auto internal xref">Section 4.2</a>):<a href="#section-4.3.1-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-13.1">info_label = 0<a href="#section-4.3.1-13.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-13.2">context  = h''<a href="#section-4.3.1-13.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-13.3">length is length of key of the EDHOC AEAD algorithm in bytes<a href="#section-4.3.1-13.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.3.1-14">The derivation of IV_1 = EDHOC-Expand(PRK, info, length) uses the following input to the info struct (see <a href="#reuse" class="auto internal xref">Section 4.2</a>):<a href="#section-4.3.1-14" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-15.1">info_label = 1<a href="#section-4.3.1-15.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-15.2">context = h''<a href="#section-4.3.1-15.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-15.3">length is length of nonce of the EDHOC AEAD algorithm in bytes<a href="#section-4.3.1-15.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="voucher">
<section id="section-4.3.2">
          <h4 id="name-voucher">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-voucher" class="section-name selfRef">Voucher</a>
          </h4>
<p id="section-4.3.2-1">The voucher is an assertion to U that W has authorized V. The voucher is essentially a message authentication code which binds the authentication credential of V, CRED_V, to message_1 of EDHOC.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2">The external authorization data EAD_2 contains an EAD item with ead_label = TBD1 and ead_value = Voucher, which is a CBOR byte string:<a href="#section-4.3.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2-3">
<pre>
Voucher = bstr .cbor EDHOC-Expand(PRK, info, length)
</pre><a href="#section-4.3.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-4">The voucher is calculated with the following input to the info struct (see <a href="#reuse" class="auto internal xref">Section 4.2</a>):<a href="#section-4.3.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.2-5.1">info_label = 2<a href="#section-4.3.2-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.2-5.2">context  = bstr .cbor voucher_input<a href="#section-4.3.2-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.2-5.3">length is EDHOC MAC length in bytes<a href="#section-4.3.2-5.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.3.2-6">where context is a CBOR byte string wrapping of the following CBOR sequence:<a href="#section-4.3.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2-7">
<pre>
voucher_input = (
    H(message_1):  bstr,
    CRED_V:        bstr,
)
</pre><a href="#section-4.3.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-8">where<a href="#section-4.3.2-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.2-9.1">H(message_1) is the hash of EDHOC message_1, calculated from the associated voucher request, see <a href="#voucher_request" class="auto internal xref">Section 4.5.1</a>.<a href="#section-4.3.2-9.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.2-9.2">CRED_V is the CWT Claims Set <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span> containing the public authentication key of V, see <a href="#V_2" class="auto internal xref">Section 4.4.2.1</a><a href="#section-4.3.2-9.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="U-V">
<section id="section-4.4">
        <h3 id="name-device-authenticator-u-v">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-device-authenticator-u-v" class="section-name selfRef">Device &lt;-&gt; Authenticator (U &lt;-&gt; V)</a>
        </h3>
<p id="section-4.4-1">This section describes the processing in U and V, which include the EDHOC protocol, see <a href="#fig-protocol" class="auto internal xref">Figure 3</a>. Normal EDHOC processing is omitted here.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div id="m1">
<section id="section-4.4.1">
          <h4 id="name-message-1">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-message-1" class="section-name selfRef">Message 1</a>
          </h4>
<div id="processing-in-u">
<section id="section-4.4.1.1">
            <h5 id="name-processing-in-u">
<a href="#section-4.4.1.1" class="section-number selfRef">4.4.1.1. </a><a href="#name-processing-in-u" class="section-name selfRef">Processing in U</a>
            </h5>
<p id="section-4.4.1.1-1">U composes EDHOC message_1 using authentication method, identifiers, etc. according to an agreed application profile, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.9" class="relref">Section 3.9</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>. The selected cipher suite, in this document denoted SS, applies also to the interaction with W as detailed in <a href="#reuse" class="auto internal xref">Section 4.2</a>, in particular, with respect to the Diffie Hellman key agreement algorithm used between U and W. As part of the normal EDHOC processing, U generates the ephemeral public key G_X which is reused in the interaction with W, see <a href="#U-W" class="auto internal xref">Section 4.3</a>.<a href="#section-4.4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1.1-2">The device sends EDHOC message_1 with EAD item (-TBD1, Voucher_Info) included in EAD_1, where Voucher_Info is specified in <a href="#U-W" class="auto internal xref">Section 4.3</a>. The negative sign indicates that the EAD item is critical, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.8" class="relref">Section 3.8</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-4.4.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-v">
<section id="section-4.4.1.2">
            <h5 id="name-processing-in-v">
<a href="#section-4.4.1.2" class="section-number selfRef">4.4.1.2. </a><a href="#name-processing-in-v" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.4.1.2-1">V receives EDHOC message_1 from U and processes it as specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-5.2.3" class="relref">Section 5.2.3</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>, with the additional step of processing the EAD item in EAD_1. Since the EAD item is critical, if V does not recognize it or it contains information that V cannot process, then V MUST discontinue EDHOC, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.8" class="relref">Section 3.8</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>. Otherwise, the ead_label = TBD1, triggers the voucher request to W as described in <a href="#V-W" class="auto internal xref">Section 4.5</a>. The exchange between V and W needs to be completed successfully for the EDHOC exchange to be continued.<a href="#section-4.4.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="m2">
<section id="section-4.4.2">
          <h4 id="name-message-2">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-message-2" class="section-name selfRef">Message 2</a>
          </h4>
<div id="V_2">
<section id="section-4.4.2.1">
            <h5 id="name-processing-in-v-2">
<a href="#section-4.4.2.1" class="section-number selfRef">4.4.2.1. </a><a href="#name-processing-in-v-2" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.4.2.1-1">V receives the voucher response from W as described in <a href="#V-W" class="auto internal xref">Section 4.5</a>.<a href="#section-4.4.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-2">V sends EDHOC message_2 to U with the critical EAD item (-TBD1, Voucher) included in EAD_2, where the Voucher is specified in <a href="#U-W" class="auto internal xref">Section 4.3</a>.<a href="#section-4.4.2.1-2" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-3">CRED_V is a CWT Claims Set <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span> containing the public authentication key of V encoded as a COSE_Key in the 'cnf' claim, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-4.4.2.1-3" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-4">ID_CRED_R contains the CWT Claims Set with 'kccs' as COSE header_map, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-9.6" class="relref">Section 9.6</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-4.4.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-u-1">
<section id="section-4.4.2.2">
            <h5 id="name-processing-in-u-2">
<a href="#section-4.4.2.2" class="section-number selfRef">4.4.2.2. </a><a href="#name-processing-in-u-2" class="section-name selfRef">Processing in U</a>
            </h5>
<p id="section-4.4.2.2-1">U receives EDHOC message_2 from V and processes it as specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-5.3.2" class="relref">Section 5.3.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>, with the additional step of processing the EAD item in EAD_2.<a href="#section-4.4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2.2-2">If U does not recognize the EAD item or the EAD item contains information that U cannot process, then U MUST discontinue EDHOC, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-3.8" class="relref">Section 3.8</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>. Otherwise U MUST verify the Voucher by performing the same calculation as in <a href="#voucher" class="auto internal xref">Section 4.3.2</a> using H(message_1) and CRED_V received in ID_CRED_R of message_2. If the voucher calculated in this way is not identical to what was received in message_2, then U MUST discontinue the protocol.<a href="#section-4.4.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-3">
<section id="section-4.4.3">
          <h4 id="name-message-3">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-message-3" class="section-name selfRef">Message 3</a>
          </h4>
<div id="processing-in-u-2">
<section id="section-4.4.3.1">
            <h5 id="name-processing-in-u-3">
<a href="#section-4.4.3.1" class="section-number selfRef">4.4.3.1. </a><a href="#name-processing-in-u-3" class="section-name selfRef">Processing in U</a>
            </h5>
<p id="section-4.4.3.1-1">If all verifications are passed, then U sends EDHOC message_3.<a href="#section-4.4.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.4.3.1-2">EDHOC message_3 may be combined with an OSCORE request, see <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span>.<a href="#section-4.4.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-v-1">
<section id="section-4.4.3.2">
            <h5 id="name-processing-in-v-3">
<a href="#section-4.4.3.2" class="section-number selfRef">4.4.3.2. </a><a href="#name-processing-in-v-3" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.4.3.2-1">V performs the normal EDHOC verifications of message_3. V may retrieve CRED_U from a Credential Database, after having learnt ID_CRED_I from U.<a href="#section-4.4.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="V-W">
<section id="section-4.5">
        <h3 id="name-authenticator-authorization">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-authenticator-authorization" class="section-name selfRef">Authenticator &lt;-&gt; Authorization Service (V &lt;-&gt; W)</a>
        </h3>
<p id="section-4.5-1">It is assumed that V and W have set up a secure connection, W has accessed the authentication credential CRED_V to be used in the EDHOC session between V and with U, and that W has verified that V is in possession of the private key corresponding to CRED_V, see <a href="#domain-auth" class="auto internal xref">Section 3.2</a> and <a href="#authz-server" class="auto internal xref">Section 3.3</a>.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">V and W run the Voucher Request/Response protocol over the secure connection. The hash of EDHOC message_1, H(message_1), acts as session identifier and binds together instances of the two protocols (U&lt;-&gt;V and V&lt;-&gt;W).<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<div id="voucher_request">
<section id="section-4.5.1">
          <h4 id="name-voucher-request">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-voucher-request" class="section-name selfRef">Voucher Request</a>
          </h4>
<div id="processing-in-v-2">
<section id="section-4.5.1.1">
            <h5 id="name-processing-in-v-4">
<a href="#section-4.5.1.1" class="section-number selfRef">4.5.1.1. </a><a href="#name-processing-in-v-4" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.5.1.1-1">V uses H(message_1) as a session identifier associated to this connection with W. If the same value of H(message_1) is already used for a connection with this or other W, the protocol SHALL be discontinued.<a href="#section-4.5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.1.1-2">V sends the voucher request to W. The Voucher Request SHALL be the CBOR array [false, message_1] where "false" is the CBOR simple value with encoding 0xf4.<a href="#section-4.5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-w">
<section id="section-4.5.1.2">
            <h5 id="name-processing-in-w">
<a href="#section-4.5.1.2" class="section-number selfRef">4.5.1.2. </a><a href="#name-processing-in-w" class="section-name selfRef">Processing in W</a>
            </h5>
<p id="section-4.5.1.2-1">W receives and parses the voucher request received over the secure connection with V. The voucher request essentially contains EDHOC message_1 as sent by U to V. W SHALL NOT process message_1 as if it was an EDHOC message intended for W.<a href="#section-4.5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.5.1.2-2">W extracts from message_1:<a href="#section-4.5.1.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1.2-3.1">SS - the selected cipher suite, which is the (last) integer of SUITES_I.<a href="#section-4.5.1.2-3.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.5.1.2-3.2">G_X - the ephemeral public key of U<a href="#section-4.5.1.2-3.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.5.1.2-3.3">ENC_ID - the encryption of the device identifier ID_U, contained in the Voucher_Info field of the EAD item with ead_label = TBD1 (with minus sign indicating criticality)<a href="#section-4.5.1.2-3.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.5.1.2-4">W verifies and decrypts ENC_ID using the relevant algorithms of the selected cipher suite SS (see <a href="#reuse" class="auto internal xref">Section 4.2</a>), and obtains ID_U.<a href="#section-4.5.1.2-4" class="pilcrow">¶</a></p>
<p id="section-4.5.1.2-5">W calculates the hash of message_1 H(message_1), and associates this session identifier to the device identifier ID_U. If H(message_1) is not unique among session identifiers associated to this device identifier of U, the protocol SHALL be discontinued.<a href="#section-4.5.1.2-5" class="pilcrow">¶</a></p>
<p id="section-4.5.1.2-6">W uses ID_U to look up the associated authorization policies for U and enforces them. This is out of scope for the specification.<a href="#section-4.5.1.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="voucher_response">
<section id="section-4.5.2">
          <h4 id="name-voucher-response">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-voucher-response" class="section-name selfRef">Voucher Response</a>
          </h4>
<div id="processing-in-w-1">
<section id="section-4.5.2.1">
            <h5 id="name-processing-in-w-2">
<a href="#section-4.5.2.1" class="section-number selfRef">4.5.2.1. </a><a href="#name-processing-in-w-2" class="section-name selfRef">Processing in W</a>
            </h5>
<p id="section-4.5.2.1-1">W retrieves CRED_V associated to the secure connection with V, and constructs the the Voucher for the device with identifier ID_U (see <a href="#voucher" class="auto internal xref">Section 4.3.2</a>).<a href="#section-4.5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.2.1-2">W generates the voucher response and sends it to V over the secure connection. The Voucher_Response SHALL be a CBOR array as defined below:<a href="#section-4.5.2.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.2.1-3">
<pre>
Voucher_Response = [
    H(message_1):   bstr,
    Voucher:        bstr
]
</pre><a href="#section-4.5.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.5.2.1-4">where<a href="#section-4.5.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2.1-5.1">H(message_1) is the session identifier.<a href="#section-4.5.2.1-5.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.5.2.1-5.2">The Voucher is defined in <a href="#voucher" class="auto internal xref">Section 4.3.2</a>.<a href="#section-4.5.2.1-5.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="processing-in-v-3">
<section id="section-4.5.2.2">
            <h5 id="name-processing-in-v-5">
<a href="#section-4.5.2.2" class="section-number selfRef">4.5.2.2. </a><a href="#name-processing-in-v-5" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.5.2.2-1">V receives the voucher response from W over the secure connection. If the received session identifier does not match a session identifier H(message_1) associated to the secure connection, the protocol SHALL be discontinued.<a href="#section-4.5.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="rest-interface-at-w">
<section id="section-5">
      <h2 id="name-rest-interface-at-w">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-rest-interface-at-w" class="section-name selfRef">REST Interface at W</a>
      </h2>
<p id="section-5-1">The interaction between V and W is enabled through a RESTful interface exposed by W.
This RESTful interface MAY be implemented using either HTTP or CoAP.
V SHOULD access the resources exposed by W through the protocol indicated by the scheme in LOC_W URI.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="scheme-https">
<section id="section-5.1">
        <h3 id="name-scheme-https">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-scheme-https" class="section-name selfRef">Scheme "https"</a>
        </h3>
<p id="section-5.1-1">In case the scheme indicates "https", V MUST perform a TLS handshake with W and use HTTP.
If the authentication credential CRED_V can be used in a TLS handshake, e.g. an X.509 certificate of a signature public key, then V SHOULD use it to authenticate to W as a client.
If the authentication credential CRED_V cannot be used in a TLS handshake, e.g. if the public key is a static Diffie-Hellman key, then V SHOULD first perform a TLS handshake with W using available compatible keys.
V MUST then perform an EDHOC handshake over the TLS connection proving to W the possession of the private key corresponding to CRED_V.
Performing the EDHOC handshake is only necessary if V did not authenticate with CRED_V in the TLS handshake with W.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scheme-coaps">
<section id="section-5.2">
        <h3 id="name-scheme-coaps">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-scheme-coaps" class="section-name selfRef">Scheme "coaps"</a>
        </h3>
<p id="section-5.2-1">In case the scheme indicates "coaps", V SHOULD perform a DTLS handshake with W and access the resources defined in <a href="#uris" class="auto internal xref">Section 5.4</a> using CoAP.
The normative requirements in <a href="#scheme-https" class="auto internal xref">Section 5.1</a> on performing the DTLS and EDHOC handshakes remain the same, except that TLS is replaced with DTLS.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scheme-coap">
<section id="section-5.3">
        <h3 id="name-scheme-coap">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-scheme-coap" class="section-name selfRef">Scheme "coap"</a>
        </h3>
<p id="section-5.3-1">In case the scheme indicates "coap", V SHOULD perform an EDHOC handshake with W, as specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#appendix-A" class="relref">Appendix A</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span> and access the resources defined in <a href="#uris" class="auto internal xref">Section 5.4</a> using OSCORE and CoAP.
The authentication credential in this EDHOC run MUST be CRED_V.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="uris">
<section id="section-5.4">
        <h3 id="name-uris">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-uris" class="section-name selfRef">URIs</a>
        </h3>
<p id="section-5.4-1">The URIs defined below are valid for both HTTP and CoAP.
W MUST support the use of the path-prefix "/.well-known/", as defined in <span>[<a href="#RFC8615" class="cite xref">RFC8615</a>]</span>, and the registered name "lake-authz".
A valid URI in case of HTTP thus begins with<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-2.1">"https://www.example.com/.well-known/lake-authz"<a href="#section-5.4-2.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-3">In case of CoAP with DTLS:<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-4.1">"coaps://example.com/.well-known/lake-authz"<a href="#section-5.4-4.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-5">In case of EDHOC and OSCORE:<a href="#section-5.4-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-6.1">"coap://example.com/.well-known/lake-authz"<a href="#section-5.4-6.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-7">Each operation specified in the following is indicated by a path-suffix.<a href="#section-5.4-7" class="pilcrow">¶</a></p>
<div id="voucher-request-voucherrequest">
<section id="section-5.4.1">
          <h4 id="name-voucher-request-voucherrequ">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-voucher-request-voucherrequ" class="section-name selfRef">Voucher Request (/voucherrequest)</a>
          </h4>
<p id="section-5.4.1-1">To request a voucher, V MUST issue a request:<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.1-2.1">Method is POST<a href="#section-5.4.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.1-2.2">Payload is the serialization of the Voucher Request object, as specified in <a href="#voucher_request" class="auto internal xref">Section 4.5.1</a>.<a href="#section-5.4.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.1-2.3">Content-Format (Content-Type) is set to "application/lake-authz-voucherrequest+cbor"<a href="#section-5.4.1-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.4.1-3">In case of successful processing at W, W MUST issue a 200 OK response with payload containing the serialized Voucher Response object, as specified in <a href="#voucher_response" class="auto internal xref">Section 4.5.2</a>.<a href="#section-5.4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="certificate-request-certrequest">
<section id="section-5.4.2">
          <h4 id="name-certificate-request-certreq">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-certificate-request-certreq" class="section-name selfRef">Certificate Request (/certrequest)</a>
          </h4>
<p id="section-5.4.2-1">V requests the public key certificate of U from W through the "/certrequest" path-suffix.
To request U's authentication credential, V MUST issue a request:<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.1">Method is POST<a href="#section-5.4.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.2-2.2">Payload is the serialization of the ID_CRED_I object, as received in EDHOC message_3.<a href="#section-5.4.2-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.4.2-3">In case of a successful lookup of the authentication credential at W, W MUST issue 200 OK response with payload containing the serialized CRED_U.<a href="#section-5.4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-cons">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">This specification builds on and reuses many of the security constructions of EDHOC, e.g., shared secret calculation and key derivation. The security considerations of EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span> apply with modifications discussed here.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">EDHOC provides identity protection of the Initiator, here the device. The encryption of the device identifier ID_U in the first message should consider potential information leaking from the length of ID_U, either by making all identifiers having the same length or the use of a padding scheme.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Although W learns about the identity of U after receiving VREQ, this information must not be disclosed to V, until U has revealed its identity to V with ID_CRED_I in message_3. W may be used for lookup of CRED_U from ID_CRED_I, or this credential lookup function may be separate from the authorization function of W, see <a href="#fig-protocol" class="auto internal xref">Figure 3</a>. The trust model used here is that U decides to which V it reveals its identity. In an alternative trust model where U trusts W to decide to which V it reveals U's identity, CRED_U could be sent in Voucher Response.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">As noted in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19#section-8.2" class="relref">Section 8.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span> an ephemeral key may be used to calculate several ECDH shared secrets. In this specification the ephemeral key G_X is also used to calculate G_XW, the shared secret with the authorization service.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">The private ephemeral key is thus used in the device for calculations of key material relating to both the authenticator and the authorization service. There are different options for where to implement these calculations, one option is as an addition to EDHOC, i.e., to extend the EDHOC API in the device with input of public key of W (G_W) and device identifier of U (ID_U), and produce the encryption of ID_U which is included in Voucher_Info in EAD_1.<a href="#section-6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="iana-ead">
<section id="section-7.1">
        <h3 id="name-edhoc-external-authorizatio">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-edhoc-external-authorizatio" class="section-name selfRef">EDHOC External Authorization Data Registry</a>
        </h3>
<p id="section-7.1-1">IANA has registered the following entry in the "EDHOC External Authorization Data" registry under the group name "Ephemeral Diffie-
   Hellman Over COSE (EDHOC)".
The ead_label = TBD_1 corresponds to the ead_value Voucher_Info in EAD_1, and Voucher in EAD_2 with processing specified in <a href="#m1" class="auto internal xref">Section 4.4.1</a> and <a href="#m2" class="auto internal xref">Section 4.4.2</a>, respectively, of this document.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<span id="name-addition-to-the-edhoc-ead-r"></span><div id="ead-table">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-addition-to-the-edhoc-ead-r" class="selfRef">Addition to the EDHOC EAD registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-right" rowspan="1" colspan="1">Label</th>
              <th class="text-left" rowspan="1" colspan="1">Value Type</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">TBD1</td>
              <td class="text-left" rowspan="1" colspan="1">bstr</td>
              <td class="text-left" rowspan="1" colspan="1">Voucher related information</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="the-well-known-uri-registry">
<section id="section-7.2">
        <h3 id="name-the-well-known-uri-registry">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-the-well-known-uri-registry" class="section-name selfRef">The Well-Known URI Registry</a>
        </h3>
<p id="section-7.2-1">IANA has registered the following entry in "The Well-Known URI Registry", using the template from <span>[<a href="#RFC8615" class="cite xref">RFC8615</a>]</span>:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-2.1">URI suffix: lake-authz<a href="#section-7.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.2">Change controller: IETF<a href="#section-7.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.3">Specification document: [[this document]]<a href="#section-7.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.4">Related information: None<a href="#section-7.2-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="well-known-name-under-arpa-name-space">
<section id="section-7.3">
        <h3 id="name-well-known-name-under-arpa-">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-well-known-name-under-arpa-" class="section-name selfRef">Well-Known Name Under ".arpa" Name Space</a>
        </h3>
<p id="section-7.3-1">This document allocates a well-known name under the .arpa name space according to the rules given in <span>[<a href="#RFC3172" class="cite xref">RFC3172</a>]</span> and <span>[<a href="#RFC6761" class="cite xref">RFC6761</a>]</span>.
The name "lake-authz.arpa" is requested.
No subdomains are expected, and addition of any such subdomains requires the publication of an IETF Standards Track RFC.
No A, AAAA, or PTR record is requested.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="media-types-registry">
<section id="section-7.4">
        <h3 id="name-media-types-registry">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-media-types-registry" class="section-name selfRef">Media Types Registry</a>
        </h3>
<p id="section-7.4-1">IANA has added the media types "application/lake-authz-voucherrequest+cbor" to the "Media Types" registry.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<div id="applicationlake-authz-voucherrequestcbor-media-type-registration">
<section id="section-7.4.1">
          <h4 id="name-application-lake-authz-vouc">
<a href="#section-7.4.1" class="section-number selfRef">7.4.1. </a><a href="#name-application-lake-authz-vouc" class="section-name selfRef">application/lake-authz-voucherrequest+cbor Media Type Registration</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-7.4.1-1.1">Type name: application<a href="#section-7.4.1-1.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.2">Subtype name: lake-authz-voucherrequest+cbor<a href="#section-7.4.1-1.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.3">Required parameters: N/A<a href="#section-7.4.1-1.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.4">Optional paramaters: N/A<a href="#section-7.4.1-1.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.5">Encoding considerations: binary<a href="#section-7.4.1-1.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.6">Security cosniderations: See <a href="#sec-cons" class="auto internal xref">Section 6</a> of this document.<a href="#section-7.4.1-1.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.7">Interoperability considerations: N/A<a href="#section-7.4.1-1.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.8">Published specification: [[this document]] (this document)<a href="#section-7.4.1-1.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.9">Application that use this media type: To be identified<a href="#section-7.4.1-1.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.10">Fragment identifier considerations: N/A<a href="#section-7.4.1-1.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.11">
              <p id="section-7.4.1-1.11.1">Additional information:<a href="#section-7.4.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.1-1.11.2.1">Magic number(s): N/A<a href="#section-7.4.1-1.11.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-7.4.1-1.11.2.2">File extension(s): N/A<a href="#section-7.4.1-1.11.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-7.4.1-1.11.2.3">Macintosh file type code(s): N/A<a href="#section-7.4.1-1.11.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.4.1-1.12">Person &amp; email address to contact for further information: See "Authors' Addresses" section.<a href="#section-7.4.1-1.12" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.13">Intended usage: COMMON<a href="#section-7.4.1-1.13" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.14">Restrictions on usage: N/A<a href="#section-7.4.1-1.14" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.15">Author: See "Authors' Addresses" section.<a href="#section-7.4.1-1.15" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.4.1-1.16">Change Controller: IESG<a href="#section-7.4.1-1.16" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="coap-content-formats-registry">
<section id="section-7.5">
        <h3 id="name-coap-content-formats-regist">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-coap-content-formats-regist" class="section-name selfRef">CoAP Content-Formats Registry</a>
        </h3>
<p id="section-7.5-1">IANA has added the media type "application/lake-authz-voucherrequest+cbor" to the "CoAP Content-Formats" registry under the registry group "Constrained RESTful Environments (CoRE) Parameters".<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<span id="name-addition-to-the-coap-conten"></span><div id="coap-content-formats">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-addition-to-the-coap-conten" class="selfRef">Addition to the CoAP Content-Formats registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Media Type</th>
              <th class="text-left" rowspan="1" colspan="1">Encoding</th>
              <th class="text-left" rowspan="1" colspan="1">ID</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">application/lake-authz-voucherrequest+cbor</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
              <td class="text-left" rowspan="1" colspan="1">TBD2</td>
              <td class="text-left" rowspan="1" colspan="1">[[this document]]</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
</section>
</div>
<section id="section-8">
      <h2 id="name-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-8.1">
        <h3 id="name-normative-references">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-lake-edhoc">[I-D.ietf-lake-edhoc]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-edhoc-19</span>, <time datetime="2023-02-03" class="refDate">3 February 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19">https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-19</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-800-56A">[NIST-800-56A]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for Pair-Wise Key-Establishment Schemes Using Discrete Logarithm Cryptography - NIST Special Publication 800-56A, Revision 3"</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8392">https://www.rfc-editor.org/info/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9052">[RFC9052]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Structures and Process"</span>, <span class="seriesInfo">STD 96</span>, <span class="seriesInfo">RFC 9052</span>, <span class="seriesInfo">DOI 10.17487/RFC9052</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9052">https://www.rfc-editor.org/info/rfc9052</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9053">[RFC9053]</dt>
      <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Initial Algorithms"</span>, <span class="seriesInfo">RFC 9053</span>, <span class="seriesInfo">DOI 10.17487/RFC9053</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9053">https://www.rfc-editor.org/info/rfc9053</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-8.2">
        <h3 id="name-informative-references">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-oscore-edhoc">[I-D.ietf-core-oscore-edhoc]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Höglund, R.</span>, <span class="refAuthor">Hristozov, S.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Using EDHOC with CoAP and OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-edhoc-07</span>, <time datetime="2023-03-13" class="refDate">13 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-07">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-07</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-cbor-encoded-cert">[I-D.ietf-cose-cbor-encoded-cert]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Raza, S.</span>, <span class="refAuthor">Höglund, J.</span>, and <span class="refAuthor">M. Furuhed</span>, <span class="refTitle">"CBOR Encoded X.509 Certificates (C509 Certificates)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-cbor-encoded-cert-05</span>, <time datetime="2023-01-10" class="refDate">10 January 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-05">https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-05</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lake-reqs">[I-D.ietf-lake-reqs]</dt>
        <dd>
<span class="refAuthor">Vučinić, M.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">D. Garcia-Carillo</span>, <span class="refTitle">"Requirements for a Lightweight AKE for OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-reqs-04</span>, <time datetime="2020-06-08" class="refDate">8 June 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-reqs-04">https://datatracker.ietf.org/doc/html/draft-ietf-lake-reqs-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE802.15.4">[IEEE802.15.4]</dt>
        <dd>
<span class="refAuthor">IEEE standard for Information Technology</span>, <span class="refTitle">"IEEE Std 802.15.4 Standard for Low-Rate Wireless Networks"</span>, <span>n.d.</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3172">[RFC3172]</dt>
        <dd>
<span class="refAuthor">Huston, G., Ed.</span>, <span class="refTitle">"Management Guidelines &amp; Operational Requirements for the Address and Routing Parameter Area Domain ("arpa")"</span>, <span class="seriesInfo">BCP 52</span>, <span class="seriesInfo">RFC 3172</span>, <span class="seriesInfo">DOI 10.17487/RFC3172</span>, <time datetime="2001-09" class="refDate">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3172">https://www.rfc-editor.org/info/rfc3172</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6761">[RFC6761]</dt>
        <dd>
<span class="refAuthor">Cheshire, S.</span> and <span class="refAuthor">M. Krochmal</span>, <span class="refTitle">"Special-Use Domain Names"</span>, <span class="seriesInfo">RFC 6761</span>, <span class="seriesInfo">DOI 10.17487/RFC6761</span>, <time datetime="2013-02" class="refDate">February 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6761">https://www.rfc-editor.org/info/rfc6761</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7228">[RFC7228]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Ersue, M.</span>, and <span class="refAuthor">A. Keranen</span>, <span class="refTitle">"Terminology for Constrained-Node Networks"</span>, <span class="seriesInfo">RFC 7228</span>, <span class="seriesInfo">DOI 10.17487/RFC7228</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7228">https://www.rfc-editor.org/info/rfc7228</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8615">[RFC8615]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Well-Known Uniform Resource Identifiers (URIs)"</span>, <span class="seriesInfo">RFC 8615</span>, <span class="seriesInfo">DOI 10.17487/RFC8615</span>, <time datetime="2019-05" class="refDate">May 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8615">https://www.rfc-editor.org/info/rfc8615</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9031">[RFC9031]</dt>
        <dd>
<span class="refAuthor">Vučinić, M., Ed.</span>, <span class="refAuthor">Simon, J.</span>, <span class="refAuthor">Pister, K.</span>, and <span class="refAuthor">M. Richardson</span>, <span class="refTitle">"Constrained Join Protocol (CoJP) for 6TiSCH"</span>, <span class="seriesInfo">RFC 9031</span>, <span class="seriesInfo">DOI 10.17487/RFC9031</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9031">https://www.rfc-editor.org/info/rfc9031</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9180">https://www.rfc-editor.org/info/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="use-with-constrained-join-protocol-cojp">
<section id="appendix-A">
      <h2 id="name-use-with-constrained-join-p">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-use-with-constrained-join-p" class="section-name selfRef">Use with Constrained Join Protocol (CoJP)</a>
      </h2>
<p id="appendix-A-1">This section outlines how the protocol is used for network enrollment and parameter provisioning.
An IEEE 802.15.4 network is used as an example of how a new device (U) can be enrolled into the domain managed by the domain authenticator (V).<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<span id="name-use-of-draft-selander-lake-"></span><div id="fig-cojp">
<figure id="figure-4">
        <div id="appendix-A-2.1">
          <div class="alignCenter art-svg artwork" id="appendix-A-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="416" width="560" viewBox="0 0 560 416" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px">
              <path d="M 8,48 L 8,400" fill="none" stroke="black"></path>
              <path d="M 304,48 L 304,384" fill="none" stroke="black"></path>
              <path d="M 552,48 L 552,384" fill="none" stroke="black"></path>
              <path d="M 280,80 L 296,80" fill="none" stroke="black"></path>
              <path d="M 16,112 L 304,112" fill="none" stroke="black"></path>
              <path d="M 8,160 L 296,160" fill="none" stroke="black"></path>
              <path d="M 304,192 L 544,192" fill="none" stroke="black"></path>
              <path d="M 312,224 L 552,224" fill="none" stroke="black"></path>
              <path d="M 16,256 L 304,256" fill="none" stroke="black"></path>
              <path d="M 8,320 L 296,320" fill="none" stroke="black"></path>
              <path d="M 16,368 L 296,368" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="552,192 540,186.4 540,197.6" fill="black" transform="rotate(0,544,192)"></polygon>
              <polygon class="arrowhead" points="320,224 308,218.4 308,229.6" fill="black" transform="rotate(180,312,224)"></polygon>
              <polygon class="arrowhead" points="304,320 292,314.4 292,325.6" fill="black" transform="rotate(0,296,320)"></polygon>
              <polygon class="arrowhead" points="304,160 292,154.4 292,165.6" fill="black" transform="rotate(0,296,160)"></polygon>
              <polygon class="arrowhead" points="304,80 292,74.4 292,85.6" fill="black" transform="rotate(0,296,80)"></polygon>
              <polygon class="arrowhead" points="24,368 12,362.4 12,373.6" fill="black" transform="rotate(180,16,368)"></polygon>
              <polygon class="arrowhead" points="24,256 12,250.4 12,261.6" fill="black" transform="rotate(180,16,256)"></polygon>
              <polygon class="arrowhead" points="24,112 12,106.4 12,117.6" fill="black" transform="rotate(180,16,112)"></polygon>
              <g class="text">
                <text x="8" y="36">U</text>
                <text x="304" y="36">V</text>
                <text x="552" y="36">W</text>
                <text x="24" y="84">-</text>
                <text x="40" y="84">-</text>
                <text x="56" y="84">-</text>
                <text x="72" y="84">-</text>
                <text x="88" y="84">-</text>
                <text x="104" y="84">-</text>
                <text x="120" y="84">-</text>
                <text x="136" y="84">-</text>
                <text x="152" y="84">-</text>
                <text x="168" y="84">-</text>
                <text x="184" y="84">-</text>
                <text x="200" y="84">-</text>
                <text x="216" y="84">-</text>
                <text x="232" y="84">-</text>
                <text x="248" y="84">-</text>
                <text x="264" y="84">-</text>
                <text x="76" y="100">Optional</text>
                <text x="144" y="100">network</text>
                <text x="228" y="100">solicitation</text>
                <text x="120" y="132">Network</text>
                <text x="192" y="132">discovery</text>
                <text x="112" y="180">EDHOC</text>
                <text x="176" y="180">message_1</text>
                <text x="368" y="212">Voucher</text>
                <text x="432" y="212">Request</text>
                <text x="492" y="212">(VREQ)</text>
                <text x="368" y="244">Voucher</text>
                <text x="436" y="244">Response</text>
                <text x="500" y="244">(VRES)</text>
                <text x="112" y="276">EDHOC</text>
                <text x="176" y="276">message_2</text>
                <text x="56" y="340">EDHOC</text>
                <text x="120" y="340">message_3</text>
                <text x="168" y="340">+</text>
                <text x="196" y="340">CoJP</text>
                <text x="248" y="340">request</text>
                <text x="124" y="388">CoJP</text>
                <text x="180" y="388">response</text>
              </g>
            </svg><a href="#appendix-A-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-use-of-draft-selander-lake-" class="selfRef">Use of draft-selander-lake-authz with CoJP.</a>
        </figcaption></figure>
</div>
<div id="network-discovery">
<section id="appendix-A.1">
        <h3 id="name-network-discovery">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-network-discovery" class="section-name selfRef">Network Discovery</a>
        </h3>
<p id="appendix-A.1-1">When a device first boots, it needs to discover the network it attempts to join.
The network discovery procedure is defined by the link-layer technology in use.
In case of Time-slotted Channel Hopping (TSCH) networks, a mode of <span>[<a href="#IEEE802.15.4" class="cite xref">IEEE802.15.4</a>]</span>, the device scans the radio channels for Enhanced Beacon (EB) frames, a procedure known as passive scan.
EBs carry the information about the network, and particularly the network identifier.
Based on the EB, the network identifier, the information pre-configured into the device, the device makes the decision on whether it should join the network advertised by the received EB frame.
This process is described in <span><a href="https://rfc-editor.org/rfc/rfc9031#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>.
In case of other, non-TSCH modes of IEEE 802.15.4 it is possible to use the active scan procedure and send solicitation frames.
These solicitation frames trigger the nearest network coordinator to respond by emitting a beacon frame.
The network coordinator emitting beacons may be multiple link-layer hops away from the domain authenticator (V), in which case it plays the role of a Join Proxy (see <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>).
Join Proxy does not participate in the protocol and acts as a transparent router between the device and the domain authenticator.
For simplicity, <a href="#fig-cojp" class="auto internal xref">Figure 4</a> illustrates the case when the device and the domain authenticator are a single hop away and can communicate directly.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="the-enrollment-protocol-with-parameter-provisioning">
<section id="appendix-A.2">
        <h3 id="name-the-enrollment-protocol-wit">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-the-enrollment-protocol-wit" class="section-name selfRef">The Enrollment Protocol with Parameter Provisioning</a>
        </h3>
<div id="flight-1">
<section id="appendix-A.2.1">
          <h4 id="name-flight-1">
<a href="#appendix-A.2.1" class="section-number selfRef">A.2.1. </a><a href="#name-flight-1" class="section-name selfRef">Flight 1</a>
          </h4>
<p id="appendix-A.2.1-1">Once the device has discovered the network it wants to join, it constructs the EDHOC message_1, as described in <a href="#U-V" class="auto internal xref">Section 4.4</a>.
The device SHALL map the message to a CoAP request:<a href="#appendix-A.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2.1-2.1">The request method is POST.<a href="#appendix-A.2.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.1-2.2">The type is Confirmable (CON).<a href="#appendix-A.2.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.1-2.3">The Proxy-Scheme option is set to "coap".<a href="#appendix-A.2.1-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.1-2.4">The Uri-Host option is set to "lake-authz.arpa". This is an anycast type of identifier of the domain authenticator (V) that is resolved to its IPv6 address by the Join Proxy.<a href="#appendix-A.2.1-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.1-2.5">The Uri-Path option is set to ".well-known/edhoc".<a href="#appendix-A.2.1-2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.1-2.6">The Content-Format option is set to "application/cid-edhoc+cbor-seq"<a href="#appendix-A.2.1-2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.1-2.7">The payload is the (true, EDHOC message_1) CBOR sequence, where EDHOC message_1 is constructed as defined in <a href="#U-V" class="auto internal xref">Section 4.4</a>.<a href="#appendix-A.2.1-2.7" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="flight-2">
<section id="appendix-A.2.2">
          <h4 id="name-flight-2">
<a href="#appendix-A.2.2" class="section-number selfRef">A.2.2. </a><a href="#name-flight-2" class="section-name selfRef">Flight 2</a>
          </h4>
<p id="appendix-A.2.2-1">The domain authenticator receives message_1 and processes it as described in <a href="#U-V" class="auto internal xref">Section 4.4</a>.
The message triggers the exchange with the authorization service, as described in <a href="#V-W" class="auto internal xref">Section 4.5</a>.
If the exchange between V and W completes successfully, the domain authenticator prepares EDHOC message_2, as described in <a href="#U-V" class="auto internal xref">Section 4.4</a>.
The authenticator SHALL map the message to a CoAP response:<a href="#appendix-A.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2.2-2.1">The response code is 2.04 Changed.<a href="#appendix-A.2.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.2-2.2">The Content-Format option is set to "application/edhoc+cbor-seq"<a href="#appendix-A.2.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.2-2.3">The payload is the EDHOC message_2, as defined in <a href="#U-V" class="auto internal xref">Section 4.4</a>.<a href="#appendix-A.2.2-2.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="flight-3">
<section id="appendix-A.2.3">
          <h4 id="name-flight-3">
<a href="#appendix-A.2.3" class="section-number selfRef">A.2.3. </a><a href="#name-flight-3" class="section-name selfRef">Flight 3</a>
          </h4>
<p id="appendix-A.2.3-1">The device receives EDHOC message_2 and processes it as described in <a href="#U-V" class="auto internal xref">Section 4.4</a>}.
Upon successful processing of message_2, the device prepares flight 3, which is an OSCORE-protected CoJP request containing an EDHOC message_3, as described in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span>.
EDHOC message_3 is prepared as described in <a href="#U-V" class="auto internal xref">Section 4.4</a>.
The OSCORE-protected payload is the CoJP Join Request object specified in <span><a href="https://rfc-editor.org/rfc/rfc9031#section-8.4.1" class="relref">Section 8.4.1</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>.
OSCORE protection leverages the OSCORE Security Context derived from the EDHOC exchange, as specified in Appendix A of <span>[<a href="#I-D.ietf-lake-edhoc" class="cite xref">I-D.ietf-lake-edhoc</a>]</span>.
To that end, <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span> specifies that the Sender ID of the client (device) must be set to the connection identifier selected by the domain authenticator, C_R.
OSCORE includes the Sender ID as the kid in the OSCORE option.
The network identifier in the CoJP Join Request object is set to the network identifier obtained from the network discovery phase.
In case of IEEE 802.15.4 networks, this is the PAN ID.<a href="#appendix-A.2.3-1" class="pilcrow">¶</a></p>
<p id="appendix-A.2.3-2">The device SHALL map the message to a CoAP request:<a href="#appendix-A.2.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2.3-3.1">The request method is POST.<a href="#appendix-A.2.3-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.3-3.2">The type is Confirmable (CON).<a href="#appendix-A.2.3-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.3-3.3">The Proxy-Scheme option is set to "coap".<a href="#appendix-A.2.3-3.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.3-3.4">The Uri-Host option is set to "lake-authz.arpa".<a href="#appendix-A.2.3-3.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.3-3.5">The Uri-Path option is set to ".well-known/edhoc".<a href="#appendix-A.2.3-3.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.3-3.6">The EDHOC option <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span> is set and is empty.<a href="#appendix-A.2.3-3.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.2.3-3.7">The payload is prepared as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-07#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span>, with EDHOC message_3 and the CoJP Join Request object as the OSCORE-protected payload.<a href="#appendix-A.2.3-3.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="appendix-A.2.3-4">Note that the OSCORE Sender IDs are derived from the connection identifiers of the EDHOC exchange.
This is in contrast with <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span> where ID Context of the OSCORE Security Context is set to the device identifier (pledge identifier).
Since the device identity is exchanged during the EDHOC handshake, and the certificate of the device is communicated to the authenticator as part of the Voucher Response message, there is no need to transport the device identity in OSCORE messages.
The authenticator playing the role of the <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span> JRC obtains the device identity from the execution of the authorization protocol.<a href="#appendix-A.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="flight-4">
<section id="appendix-A.2.4">
          <h4 id="name-flight-4">
<a href="#appendix-A.2.4" class="section-number selfRef">A.2.4. </a><a href="#name-flight-4" class="section-name selfRef">Flight 4</a>
          </h4>
<p id="appendix-A.2.4-1">Flight 4 is the OSCORE response carrying CoJP response message.
The message is processed as specified in <span><a href="https://rfc-editor.org/rfc/rfc9031#section-8.4.2" class="relref">Section 8.4.2</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>.<a href="#appendix-A.2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Göran Selander</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:goran.selander@ericsson.com" class="email">goran.selander@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Preuß Mattsson</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:john.mattsson@ericsson.com" class="email">john.mattsson@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mališa Vučinić</span></div>
<div dir="auto" class="left"><span class="org">INRIA</span></div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:malisa.vucinic@inria.fr" class="email">malisa.vucinic@inria.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Richardson</span></div>
<div dir="auto" class="left"><span class="org">Sandelman Software Works</span></div>
<div dir="auto" class="left"><span class="country-name">Canada</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mcr+ietf@sandelman.ca" class="email">mcr+ietf@sandelman.ca</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Aurelio Schellenbaum</span></div>
<div dir="auto" class="left"><span class="org">Institute of Embedded Systems, ZHAW</span></div>
<div dir="auto" class="left"><span class="country-name">Switzerland</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:aureliorubendario.schellenbaum@zhaw.ch" class="email">aureliorubendario.schellenbaum@zhaw.ch</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
